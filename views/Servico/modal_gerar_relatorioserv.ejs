<div id="modalRelatorioServicos" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <button class="back-button" onclick="fecharOuVoltarRelatorio()">
          <i class="arrow-left"><img src="/assets/Icon (1).png" alt="voltar"/></i>
        </button>
        <h2>Relatório de Serviços Realizados</h2>
        <button class="home-button" onclick="window.location.href='/home'">
          <i class="home-icon"><img src="/assets/home-lg-alt 1.png" alt="home"/></i>
        </button>
      </div>
  
      <div class="modal-body">
        <!-- Tela de Seleção de Período -->
        <div id="telaPeriodoServico" class="center-content">
          <form id="periodoFormServico">
            <div class="form-group">
              <label for="dataInicioServico">Data Início:</label>
              <input type="date" id="dataInicioServico" required />
            </div>
            <div class="form-group" style="margin-top: 20px">
              <label for="dataFimServico">Data Fim:</label>
              <input type="date" id="dataFimServico" required />
            </div>
            <div class="form-btn-cons" style="margin-top: 20px">
              <button type="button" class="consultar-btn" onclick="gerarRelatorioServicos()">
                Gerar Relatório
              </button>
            </div>
          </form>
        </div>
        
        <!-- Tela de Resultado -->
        <div id="resultadoRelatorioServico">
          <div class="relatorio-sumario">
            <h3>Resumo do Período</h3>
            <div class="resumo-item">
              <span>Total de Serviços:</span>
              <span id="totalServicos">0</span>
            </div>
            <div class="resumo-item">
              <span>Valor Total:</span>
              <span id="valorTotalServicos">R$ 0,00</span>
            </div>
          </div>
          
          <div class="relatorio-detalhes">
            <h3>Detalhamento</h3>
            <table id="tabelaServicos">
              <thead>
                <tr>
                  <th>Data</th>
                  <th>Serviço</th>
                  <th>Veículo</th>
                  <th>Valor</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
          
          <div class="form-btn-download">
            <button type="button" class="download-btn" onclick="baixarRelatorioServicos()">
              Exportar para Excel
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    // Gera o relatório
    async function gerarRelatorioServicos() {
      const dataInicio = document.getElementById("dataInicioServico").value;
      const dataFim = document.getElementById("dataFimServico").value;
  
      if (!dataInicio || !dataFim) {
        alert("Selecione ambas as datas");
        return;
      }
  
      try {
        const response = await fetch(`/servicos/relatorio?dataInicio=${dataInicio}&dataFim=${dataFim}`);
        const relatorio = await response.json();
  
        // Preenche o resumo
        document.getElementById("totalServicos").textContent = relatorio.totalServicos;
        document.getElementById("valorTotalServicos").textContent = `R$ ${parseFloat(relatorio.totalValor).toFixed(2).replace(".", ",")}`;
  
        // Preenche a tabela
        const tbody = document.querySelector("#tabelaServicos tbody");
        tbody.innerHTML = relatorio.servicosRealizados.map(servico => `
          <tr>
            <td>${servico.data}</td>
            <td>${servico.tipoServico}</td>
            <td>${servico.veiculo}</td>
            <td>R$ ${parseFloat(servico.valor).toFixed(2).replace(".", ",")}</td>
          </tr>
        `).join('');
  
        // Mostra resultado
        document.getElementById("telaPeriodoServico").style.display = "none";
        document.getElementById("resultadoRelatorioServico").style.display = "block";
      } catch (error) {
        alert("Erro ao gerar relatório");
      }
    }
  
    // Função para exportar (simulada)
    function baixarRelatorioServicos() {
      alert("Relatório exportado com sucesso!");
    }
  
    function fecharOuVoltarRelatorio() {
      if (document.getElementById("resultadoRelatorioServico").style.display !== "none") {
        document.getElementById("resultadoRelatorioServico").style.display = "none";
        document.getElementById("telaPeriodoServico").style.display = "flex";
        document.getElementById("periodoFormServico").reset();
      } else {
        fecharModal("modalRelatorioServicos");
      }
    }
  </script>
  
  <style>
    .relatorio-sumario {
      background: #f5f5f5;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 20px;
    }
    
    .resumo-item {
      display: flex;
      justify-content: space-between;
      margin: 10px 0;
    }
    
    .relatorio-detalhes {
      margin-bottom: 20px;
    }
    
    #tabelaServicos {
      width: 100%;
      border-collapse: collapse;
    }
    
    #tabelaServicos th, #tabelaServicos td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }
    
    #tabelaServicos th {
      background-color: #f2f2f2;
    }
    
    .funcionarios-list {
      margin-top: 10px;
    }
    
    .funcionario-item {
      padding: 5px;
      border-bottom: 1px solid #eee;
    }
  </style>
  